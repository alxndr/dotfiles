# unixy
alias ..="cd .."
alias ...="cd ../.."
alias ....="cd ../../.."
alias c="cat"
alias e="exa"
alias el="exa -aFl"
alias f="rg --files"
alias gr="grep"
alias ls="ls -F"
alias l="exa -aFl"
alias ll="exa -aFl"
      lsd() {
        if [[ -n "$1" ]]; then
          ls -G -d $1/*(D/)
        else
          # h/t StÃ©phane https://unix.stackexchange.com/a/502028/48320
          ls -G -d -- *(D/)
        fi
      }
alias ln="ln -v"
alias tlf="tail -f"
alias top="top -o cpu -O vsize"
alias tophistory="history | awk '{a[$2]++}END{for(i in a){print a[i] " " i}}' | sort -rn | head -n30" # https://coderwall.com/p/o5qijw
alias tzf="tar -zxvf"
      until_fail() { eval "$@"; while [ "$(echo $?)" -eq "0" ]; do eval "$@"; done }
alias uq="cat -n | sort -uk2 | sort -nk1 | cut -f2-" # h/t https://stackoverflow.com/a/20639730/303896
alias wh="which"

# mac-y
      battery() { ioreg -n AppleSmartBattery -r | awk '$1~/Capacity/{c[$1]=$3} END{OFMT="%.0f%%"; max=c["\"MaxCapacity\""]; print (max>0? 100*c["\"CurrentCapacity\""]/max: "?")}' }
alias fixcamera="sudo killall AppleCameraAssistant && sudo killall VDCAssistant" # h/t @GregMefford
      notify() { osascript -e "display notification \"$2\" with title \"$1\"" }
alias nv="nvim"
alias tac="tail -r"

# rake
alias r="rake" # overrides zsh's builtin shortcut but who cares
alias rT="rake --tasks"

# git
alias gA="git add --all"
alias gap="git add --patch"
alias gb="git branch --color"
alias gbb="git bisect bad"
alias gbg="git bisect good"
alias gcompare="git show-branch \$([[ -e .git ]] && git rev-parse --abbrev-ref HEAD) origin/\$([[ -e .git ]] && git rev-parse --abbrev-ref HEAD)"
alias gcv="git commit --verbose --no-verify"
alias gd="git diff --color-words='[^[:space:]]|([[:alnum:]]|UTF_8_GUARD)+'."
alias gdd="git diff"
      gdiff() {
        $FIRST=$1
        $SECOND=$2
        $FILE=$3
        diff <(git show :$FIRST:$FILE) <(git show :$SECOND:$FILE)
      }
alias gds="gd --staged"
alias gh="giturl | xargs open"
      ghb() {
        BASE=$(giturl)
        BRANCH=$(git branch-name)
        open ${BASE}/compare/develop...${BRANCH}
      }
alias giturl="git config --get remote.origin.url | sed -e 's/\/\///' -e 's/git.//' -e 's/:/\//' -e 's/\.git//' -e 's/^/http:\/\//'"
unalias gl
alias gl="git l"
unalias glg
alias glg="git lg"
alias glu="git log -u"
alias gmd="git co develop && git pull && git co - && git merge develop"
alias gp="git pull"
      gphb() { # git push heroku branch
        if [[ -z "$1" ]]; then
          echo "need to specify what git remote is the heroku target... exiting..."
          return 2
        fi
        GIT_BRANCH=$(git name-rev --name-only HEAD)
        if [[ -z "$GIT_BRANCH" ]]; then
          return 1
        fi
        git push $1 $GIT_BRANCH:master
      }
      gpop() {
        if [[ -z "$1" ]]; then
          git stash pop
        else
          git stash pop stash@{$1}
        fi
      }
alias greset="git reset --hard HEAD" # to get out of the habit of `gco .`
      gri() { git rebase --interactive "HEAD~$1" }
unalias gss
      gss() {
        if [[ -z "$1" ]]; then
          git stash show --patch stash@{0}
        else
          git stash show --patch stash@{$1}
        fi
      }
alias s="git status --short"

# docker
alias d="docker"
alias dc="docker-compose"
alias dm="docker-machine"
alias dmenv="eval \"\$(docker-machine env default)\""
      docker-scrub() {
        docker rm $(docker ps -q -f 'status=exited')
        docker rmi $(docker images -f "dangling=true" -q)
        docker volume rm $(docker volume ls -qf dangling=true)
        docker image prune
        docker container prune
        docker volume prune
      }

# dev-y
alias ack="echo don\'t you mean $ rg"
alias actl="apachectl"
alias ag="echo don\'t you mean $ rg"
alias again="~ && -" # so rvm reloads your .ruby-version file
alias b="brew"
alias bl="bundle"
      branch() { SEARCHTERM=$1; git branch | grep $SEARCHTERM | sed -e 's/^\* //' | awk '{ if (NR==1 || $1 == searchterm) result = $1 } END{ if (result) { print result } else { exit 1 } }' searchterm=$SEARCHTERM }
      catenv() {
        [ -r .env ] && env $(grep -E "^(export )?[A-Z]" .env | xargs) $@
      }
      decode_jwt() {
        if [[ -n "$1" ]]; then
          JWT=$1
        else
          read JWT
        fi
        JWT_SPLIT=(${(s:.:)JWT}) # split on periods
        for JWT_PIECE in $JWT_SPLIT; do
          echo
          echo $JWT_PIECE | base64 -D
          echo
        done
      }
alias eau="mix test && eautotest"
alias eautotest="ls {lib,web}/**/*.ex test/**/*.exs mix.exs mix.lock config/{config,test}.exs | entr -d mix test"
      extract_urls() {
        [[ -z "$1" ]] && echo "Usage: spider url [depth=5]" && return 1
        lynx \
          -dump \
          -listonly \
          $1 \
        | awk '/^ *[0-9]/ {print $2}'
      }
alias gx="gigalixir"
alias h="hex"
alias ism="iex -S mix"
alias ismp="iex -S mix phx.server"
alias m="mix"
alias meb="mix escript.build"
alias mps="mix phx.server"
alias mt="mix test"
alias n="npm"
alias nd="node"
alias ndd="nodemon"
alias ni="npm install"
alias niD="npm install --save-dev"
alias niS="npm install --save"
alias nr="npm run --silent"
alias nt="rg --type js --files . | entr -d sh -c 'echo detected file change\; running tests... && npm run --silent test'"
alias nw="/Applications/nwjs.app/Contents/MacOS/nwjs"
alias nvm="echo \"You probably want fnm, not nvm...\""
alias nx="npx"
alias pryrails="pry -r ./config/environment"
      report() { $@ && say "done" || say "error" }
alias sactl="sudo apachectl"
alias start_postgres="pg_ctl -D /usr/local/var/postgres -l /usr/local/var/postgres/server.log start"
alias us="bundle exec unicorn -c tmp/unicorn.rb"
      upyet() {
        URL=$1
        until [[ $(curl -Is $URL | grep "HTTP\S* 200 OK") ]]; do
          echo -n .
          sleep 5
        done
        echo $URL
        date
      }
alias y="yarn"

mine-solo() {
  cgminer \
    --url=stratum+tcp://solo.ckpool.org:3333 \
    --user=1PEkTX4iZXmpsKGRJTJMn8FThaHkrhaJb7 \
    --pass x \
    --gekko-2pac-freq 130 \
    --suggest-diff 10000
}

webm2mp3() {
  ffmpeg -i "$1" -vn -f mp3 "${1%.webm}.mp3"
}
